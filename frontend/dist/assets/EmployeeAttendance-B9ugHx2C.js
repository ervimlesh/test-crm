import{h as D,a as v,r as h,j as e,b as A}from"./index-DDoEHnfR.js";import{u as m,w as M,F as k}from"./FileSaver.min-czPidsmy.js";import{L as B}from"./Layout-Co7qzEc2.js";import{S as E}from"./SideBar-DCoEgSRU.js";const L=()=>{const{id:u}=D(),g=v(),[x,f]=h.useState([]),[b,S]=h.useState(""),[c,N]=h.useState(null);h.useEffect(()=>{(async()=>{var s;try{const n=await A.get(`/api/v1/management/attendance-data/${u}`);f(((s=n.data)==null?void 0:s.attendance)||[])}catch(n){console.error("Error fetching attendance",n),S("Failed to fetch attendance records")}})()},[u]);const i=t=>{if(!t||isNaN(t))return"00:00:00";const s=Math.floor(t/3600),n=Math.floor(t%3600/60),a=Math.floor(t%60);return`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}:${String(a).padStart(2,"0")}`},p=(t,s)=>{if(!t||!s)return 0;const[n,a,j]=t.split(":").map(Number),[r,o,l]=s.split(":").map(Number),d=n*3600+a*60+j,w=r*3600+o*60+l;return Math.max(0,w-d)},y=()=>{const t=x.map((r,o)=>{const l=r.sessions[0],d=r.sessions[r.sessions.length-1];return{"S. No":o+1,"Punch-In Date":new Date(r.date).toLocaleDateString("en-US"),"Punch-In Time":(l==null?void 0:l.in)||"-","Punch-Out Time":(d==null?void 0:d.out)||"-","Total Shift Duration":i(r.totalShiftDuration||0)}}),s=m.json_to_sheet(t),n=m.book_new();m.book_append_sheet(n,s,"Attendance");const a=M(n,{bookType:"xlsx",type:"binary"}),j=r=>{const o=new ArrayBuffer(r.length),l=new Uint8Array(o);for(let d=0;d<r.length;d++)l[d]=r.charCodeAt(d)&255;return o};k.saveAs(new Blob([j(a)],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),"attendance.xlsx")};return e.jsx(B,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(E,{}),e.jsxs("div",{className:"flex-grow-1 p-4",children:[e.jsx("h2",{children:"Attendance Records"}),b&&e.jsx("p",{style:{color:"red"},children:b}),e.jsx("button",{className:"btn btn-success mb-3",onClick:y,children:"Download Excel"}),x.length===0?e.jsx("p",{children:"No attendance records found."}):e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"S. No"}),e.jsx("th",{children:"Punch-In Date"}),e.jsx("th",{children:"Punch-In Time"}),e.jsx("th",{children:"Punch-Out Time"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:x.map((t,s)=>{const n=t.sessions[0],a=t.sessions[t.sessions.length-1];return e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:new Date(t.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),e.jsx("td",{children:(n==null?void 0:n.in)||"-"}),e.jsx("td",{children:(a==null?void 0:a.out)||"-"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>N(t),"data-bs-toggle":"modal","data-bs-target":"#detailsModal",children:"View"})})]},t._id)})})]}),e.jsx("div",{className:"modal fade",id:"detailsModal",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Attendance Details"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Date:"})," ",new Date(c.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Total Shift Duration:"})," ",i(c.totalShiftDuration||0)]}),e.jsx("h6",{children:"Sessions"}),e.jsxs("table",{className:"table table-bordered table-sm",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"In"}),e.jsx("th",{children:"Out"}),e.jsx("th",{children:"Duration"})]})}),e.jsx("tbody",{children:c.sessions.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",children:"No sessions"})}):c.sessions.map((t,s)=>{const n=p(t.in,t.out);return e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t.in||"-"}),e.jsx("td",{children:t.out||"-"}),e.jsx("td",{children:i(n)})]},s)})})]}),e.jsx("h6",{children:"Breaks"}),["teaBreak1","lunchBreak","teaBreak2"].map(t=>e.jsxs("div",{children:[e.jsxs("b",{children:[t,":"]}),e.jsxs("table",{className:"table table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"In"}),e.jsx("th",{children:"Out"}),e.jsx("th",{children:"Duration"})]})}),e.jsx("tbody",{children:c[t].length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",children:"No records"})}):c[t].map((s,n)=>{const a=p(s.in,s.out);return e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsx("td",{children:s.in||"-"}),e.jsx("td",{children:s.out||"-"}),e.jsx("td",{children:i(a)})]},n)})})]})]},t))]}):e.jsx("p",{children:"No record selected"})})]})})}),e.jsx("button",{className:"btn btn-secondary mt-3",onClick:()=>g(-1),children:"Back"})]})]})})};export{L as default};
