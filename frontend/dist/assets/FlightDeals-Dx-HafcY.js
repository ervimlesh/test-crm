import{n as G,r as l,p as H,j as t}from"./index-DDoEHnfR.js";import{L as J}from"./Layout-Co7qzEc2.js";import{S as K}from"./SideBar-DCoEgSRU.js";import{P as V}from"./PopFlightDeals-PxfNBhfF.js";import{D as A}from"./index.es-_Aq59fjB.js";/* empty css                         */import"./jspdf.es.min-CSfEVfgj.js";import"./clsx-B-dksMZM.js";const M=H(),st=()=>{const{flightDeals:n,setFlightDeals:O,loading:_,setLoading:W,errorCode:k,fetchFlightDeals:S}=G(),[y,w]=l.useState(!1),[L,C]=l.useState(null),[r,d]=l.useState(n),[i,h]=l.useState(1),[x,F]=l.useState(null),[m,P]=l.useState(null),[g,v]=l.useState(""),[u,R]=l.useState(!1),f=5,o="newBooking",j="rejected";l.useEffect(()=>{S()},[]),l.useEffect(()=>(M.on("newFlightAdded",e=>{e.success&&(O(s=>[e.data,...s]),d(s=>[e.data,...s]))}),()=>{M.off("")}),[]),l.useEffect(()=>{U()},[x,m,g,n]);const U=()=>{let e=n;x&&(e=e.filter(s=>new Date(s.createdAt)>=new Date(x))),m&&(e=e.filter(s=>new Date(s.createdAt)<=new Date(m))),g.trim()&&(e=e.filter(s=>{var c;return(c=s.bookingId)==null?void 0:c.includes(g.trim())})),d(e)},E=()=>{F(null),P(null),v(""),d(n)},b=e=>{let s;const c=new Date().toISOString().split("T")[0];switch(e){case"today":s=n.filter(a=>new Date(a.createdAt).toISOString().split("T")[0]===c);break;case o:s=n.filter(a=>a.status===o);break;case j:s=n.filter(a=>a.status===j);break;default:s=n}d(s)},p=e=>{h(e)};l.useEffect(()=>{if(r.length>0){const e=Math.ceil(r.length/f);i>e?h(e):i<1&&h(1)}else h(1)},[i,r]);const T=()=>{R(!u)},B=Math.ceil(r.length/f),D=(i-1)*f,I=r.slice(D,D+f),N=r.filter(e=>e.status===o).length,$=()=>{w(!1),C(null)};return t.jsxs(J,{children:[t.jsxs("div",{className:"d-flex",children:[t.jsx(K,{todayDealsCount:N}),t.jsxs("div",{className:"flex-grow-1 p-4",children:[t.jsx("h2",{className:"text-start",children:"All Flight Details"}),t.jsxs("div",{className:"d-flex gap-2 mb-3",children:[t.jsxs("button",{className:"btn btn-danger",onClick:()=>b("today"),children:["Today's Booking:"," ",t.jsx("strong",{children:n.filter(e=>new Date(e.createdAt).toISOString().split("T")[0]===new Date().toISOString().split("T")[0]).length})]}),t.jsxs("button",{className:"btn btn-success",onClick:E,children:["Total Booking: ",t.jsx("strong",{children:n.length})]}),t.jsxs("button",{className:"btn btn-warning",onClick:()=>b(o),children:["New Booking:"," ",t.jsx("strong",{children:n.filter(e=>e.status===o).length})]}),t.jsxs("button",{className:"btn btn-danger",onClick:()=>b(j),children:["Rejected Booking:"," ",t.jsx("strong",{children:n.filter(e=>e.status===j).length})]})]}),u?t.jsxs("div",{className:"alert alert-info",children:[N>0?t.jsxs(t.Fragment,{children:[t.jsxs("strong",{children:[t.jsx("span",{className:"badge bg-info text-dark fs-5",children:N})," ","Notifications"]}),t.jsx("ul",{children:r.filter(e=>e.status===o).map((e,s)=>t.jsxs("li",{children:[s+1,": Booking ID ",e.bookingId,":"," ",e.firstName," (",e.email,")"]},e._id))})]}):"No new bookings at the moment.",t.jsxs("button",{className:"btn btn-link text-dark",onClick:T,children:[u?"Hide":"Show"," Notifications"]})]}):t.jsx("button",{className:"btn btn-link text-dark",onClick:T,children:"Show Notifications"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h5",{children:"Filter Options"}),t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx(A,{selected:x,onChange:e=>F(e),placeholderText:"Start Date",dateFormat:"MM-dd-yyyy",className:"form-control",maxDate:new Date}),t.jsx(A,{selected:m,onChange:e=>P(e),placeholderText:"End Date",dateFormat:"MM-dd-yyyy",className:"form-control",maxDate:new Date}),t.jsx("input",{type:"text",value:g,onChange:e=>v(e.target.value),placeholder:"Enter Booking ID",className:"form-control"})]}),t.jsx("button",{className:"btn btn-secondary mt-3",onClick:E,children:"Clear Filters"})]}),t.jsxs("table",{className:"table table-striped table-bordered",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"#"}),t.jsx("th",{children:"First Name"}),t.jsx("th",{children:"Mobile"}),t.jsx("th",{children:"Email"}),t.jsx("th",{children:"Action"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"approve/reject/refresh by"})]})}),t.jsx("tbody",{children:I.length?I.map((e,s)=>t.jsxs("tr",{children:[t.jsx("td",{children:D+s+1}),t.jsx("td",{children:e.firstName}),t.jsx("td",{children:e.mobile}),t.jsx("td",{children:e.email}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-primary btn-sm text-nowrap",onClick:()=>{C(e),w(!0)},children:"View Details"})}),t.jsx("td",{children:t.jsx("span",{className:`${e.status==="approved"?"text-success":e.status==="rejected"?"text-danger":"text-primary"}`,children:e.status})}),t.jsxs("td",{children:[" ",e.approvedBy||"-"]})]},e._id)):t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"text-center",children:_?"Loading...":k||"No flight deals available."})})})]}),t.jsxs("div",{className:"pagination mt-3",children:[t.jsx("button",{className:"btn btn-secondary mx-1",onClick:()=>p(i-1),disabled:i<=1,children:"Prev"}),Array.from({length:3},(e,s)=>{const c=s-0,a=i+c;return a<1||a>B?null:t.jsx("button",{className:`btn ${i===a?"btn-primary":"btn-secondary"} mx-1`,onClick:()=>p(a),children:a},a)}),t.jsx("button",{className:"btn btn-secondary mx-1",onClick:()=>p(i+1),disabled:i>=B,children:"Next"})]})]})]}),y&&t.jsx(V,{flightDealsPop:y,deals:L,onClose:$,fetchFlightDeals:S})]})};export{st as default};
