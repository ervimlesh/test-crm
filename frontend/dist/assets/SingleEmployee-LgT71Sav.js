import{u as V,r as m,b as I,V as P,j as e}from"./index-DDoEHnfR.js";import{L as q}from"./Layout-Co7qzEc2.js";import{S as G}from"./SideBar-DCoEgSRU.js";import{t as J,a as K}from"./formatUTC-BuynropG.js";import{D as R}from"./index.es-_Aq59fjB.js";/* empty css                         */import"./clsx-B-dksMZM.js";const A=c=>{if(!c||isNaN(c))return"00:00:00";const s=Math.floor(c/3600),a=Math.floor(c%3600/60),p=Math.floor(c%60);return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(p).padStart(2,"0")}`},v=(c,s)=>{if(!c||!s)return 0;const[a,p,y]=c.split(":").map(Number),[x,D,j]=s.split(":").map(Number),F=a*3600+p*60+y,w=x*3600+D*60+j;return Math.max(0,w-F)},T=(c=[],s=0)=>{if(!(c!=null&&c.length))return s||0;const a=c[c.length-1];if(a!=null&&a.in&&!(a!=null&&a.out)){const p=new Date,[y,x,D]=a.in.split(":").map(Number),j=new Date;return j.setHours(y,x,D,0),s+Math.floor((p-j)/1e3)}return s},ne=()=>{const{auth:c}=V(),[s,a]=m.useState({}),[p,y]=m.useState(0),[x,D]=m.useState([]),[j,F]=m.useState(""),[w,L]=m.useState(""),E=m.useCallback(async()=>{try{const n=await I.get("/api/v1/management/today",{headers:{Authorization:c==null?void 0:c.token}});a(n.data)}catch{P.error("Failed to fetch data")}},[c==null?void 0:c.token]),g=m.useCallback(async(n="",l="")=>{try{const o=await I.get("/api/v1/management/login-attendance",{params:n&&l?{from:n,to:l}:{}});D(o.data||[])}catch(o){console.log(o)}},[]),U=m.useCallback(()=>{g(J(j),K(w))},[j,w,g]),z=()=>{F(""),L(""),g()};m.useEffect(()=>{E(),g()},[E,g]),m.useEffect(()=>{const n=setInterval(()=>{y(T(s==null?void 0:s.sessions,(s==null?void 0:s.totalShiftDuration)||0))},1e3);return()=>clearInterval(n)},[s]);const H=async n=>{try{await I.post("/api/v1/management/punch-in",{breakType:n},{headers:{Authorization:c==null?void 0:c.token}}),P.success("Punched in!"),E(),g()}catch{P.error("Punch in failed")}},$=async n=>{try{await I.put("/api/v1/management/punch-out",{breakType:n},{headers:{Authorization:c==null?void 0:c.token}}),P.success("Punched out!"),E(),g()}catch{P.error("Punch out failed")}},k=n=>{var d;if(!n){const t=(d=s==null?void 0:s.sessions)==null?void 0:d[s.sessions.length-1];return!!(t!=null&&t.in&&!(t!=null&&t.out))}const l=s==null?void 0:s[n];if(!l||l.length===0)return!1;const o=l[l.length-1];return!!(o!=null&&o.in)},B=n=>{var d;if(!n){const t=(d=s==null?void 0:s.sessions)==null?void 0:d[s.sessions.length-1];return!(t!=null&&t.in&&!(t!=null&&t.out))}const l=s==null?void 0:s[n];if(!l||l.length===0)return!0;const o=l[l.length-1];return!(o!=null&&o.in&&!(o!=null&&o.out))},O=(n,l)=>{var S,C,M;let o="--",d="--",t=0,f="";if(l){const i=s==null?void 0:s[l],r=i==null?void 0:i[(i==null?void 0:i.length)-1];if(r){o=(r==null?void 0:r.in)||"--",d=(r==null?void 0:r.out)||"--";const b=(r==null?void 0:r.in)&&!(r!=null&&r.out);t=i==null?void 0:i.reduce((N,u)=>N+v(u.in,u.out),0),b?(t=T(i,t),f="Current Break: "):f="Total: "}}else{const i=(C=s==null?void 0:s.sessions)==null?void 0:C[((S=s==null?void 0:s.sessions)==null?void 0:S.length)-1];if(i){o=(i==null?void 0:i.in)||"--",d=(i==null?void 0:i.out)||"--";const r=(i==null?void 0:i.in)&&!(i!=null&&i.out);t=(M=s==null?void 0:s.sessions)==null?void 0:M.reduce((b,N)=>b+v(N.in,N.out),0),r?(t=p,f="Current Shift: "):f="Total: "}}return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("h5",{children:n}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col",children:[e.jsx("button",{className:"btn btn-primary w-100",onClick:()=>H(l),disabled:k(l),children:"Punch In"}),e.jsx("p",{children:o})]}),e.jsxs("div",{className:"col",children:[e.jsx("button",{className:"btn btn-primary w-100",onClick:()=>$(l),disabled:B(l),children:"Punch Out"}),e.jsx("p",{children:d})]})]}),e.jsxs("div",{className:"bg-light mt-2 p-2 rounded",children:[f," ",A(t)]})]})})})};return e.jsx(q,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(G,{}),e.jsxs("div",{className:"container",children:[e.jsx("h3",{className:"mb-4",children:"Attendance"}),e.jsxs("div",{className:"row",children:[O("Overall Timing",null),O("Tea Break 1","teaBreak1"),O("Lunch Break","lunchBreak"),O("Tea Break 2","teaBreak2")]}),e.jsx("h3",{className:"mt-5",children:"All Attendance Data"}),e.jsxs("div",{className:"table-responsive",children:[e.jsxs("div",{className:"mb-4 d-flex gap-3 align-items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"From:"}),e.jsx(R,{selected:j,onChange:n=>F(n),className:"form-control",dateFormat:"yyyy-MM-dd"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"To:"}),e.jsx(R,{selected:w,onChange:n=>L(n),className:"form-control",dateFormat:"yyyy-MM-dd"})]}),e.jsx("button",{className:"btn btn-primary mt-4",onClick:U,children:"Apply Filter"}),e.jsx("button",{className:"btn btn-danger mt-4",onClick:z,children:"Reset"})]}),e.jsxs("table",{className:"table table-bordered text-center",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Punch In Time"}),e.jsx("th",{children:"Punch Out Time"}),e.jsx("th",{children:"Overall Time"}),e.jsx("th",{children:"Tea 1"}),e.jsx("th",{children:"Lunch"}),e.jsx("th",{children:"Tea 2"})]})}),e.jsx("tbody",{children:(x==null?void 0:x.length)>0?x.map((n,l)=>{var o,d,t,f,S,C,M,i,r,b,N;return e.jsxs("tr",{children:[e.jsx("td",{children:l+1}),e.jsx("td",{children:(o=n==null?void 0:n.employee)==null?void 0:o.userName}),e.jsx("td",{children:((d=n==null?void 0:n.employee)==null?void 0:d.email)||"N/A"}),e.jsx("td",{children:n!=null&&n.date?new Date(n.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""}),e.jsx("td",{children:((f=(t=n==null?void 0:n.sessions)==null?void 0:t[0])==null?void 0:f.in)||"--"}),e.jsx("td",{children:((M=(C=n==null?void 0:n.sessions)==null?void 0:C[((S=n==null?void 0:n.sessions)==null?void 0:S.length)-1])==null?void 0:M.out)||"--"}),e.jsx("td",{children:A((i=n==null?void 0:n.sessions)==null?void 0:i.reduce((u,h)=>u+v(h.in,h.out),0))}),e.jsx("td",{children:A((r=n==null?void 0:n.teaBreak1)==null?void 0:r.reduce((u,h)=>u+v(h.in,h.out),0))}),e.jsx("td",{children:A((b=n==null?void 0:n.lunchBreak)==null?void 0:b.reduce((u,h)=>u+v(h.in,h.out),0))}),e.jsx("td",{children:A((N=n==null?void 0:n.teaBreak2)==null?void 0:N.reduce((u,h)=>u+v(h.in,h.out),0))})]},l)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"No attendance data available"})})})]})]})]})]})})};export{ne as default};
