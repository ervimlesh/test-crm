import{f as L,e as R,r,j as e,N as $}from"./index-DDoEHnfR.js";import{L as K}from"./Layout-Co7qzEc2.js";import{S as G}from"./SideBar-DCoEgSRU.js";import{D as O}from"./index.es-_Aq59fjB.js";import{t as J,a as V}from"./formatUTC-BuynropG.js";import"./clsx-B-dksMZM.js";const nt=()=>{const{ctmFlightDeals:c,loading:M,errorCode:w}=L(),{agent:j}=R();console.log("agents is ",j);const[W,q]=r.useState(!1),[z,H]=r.useState(null),[m,N]=r.useState(c||[]),[d,B]=r.useState(""),[l,u]=r.useState(1),[f,A]=r.useState(null),[y,C]=r.useState(null),[k,I]=r.useState(""),[S,D]=r.useState(null),b=5,g="underFollowUp",x="ticketMco",p="cancelled";r.useEffect(()=>{E()},[f,y,k,c,S,d]);const E=()=>{let t=c||[];if(S){const s=new Date().toISOString().split("T")[0];switch(S){case"today":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s);break;case g:t=t.filter(n=>(n==null?void 0:n.ticketmco)===g);break;case x:t=t.filter(n=>(n==null?void 0:n.ticketmco)===x);break;case p:t=t.filter(n=>(n==null?void 0:n.ticketmco)===p);break;case"todayUnderFollowUp":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s&&(n==null?void 0:n.ticketmco)===g);break;case"todayTicketMco":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s&&(n==null?void 0:n.ticketmco)===x);break;case"todayCancelled":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s&&(n==null?void 0:n.ticketmco)===p);break;case"todayPendingAgent":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s&&(n==null?void 0:n.agentFigure)==="yes"&&(n==null?void 0:n.ticketmco)!=="ticketMco");break;case"allPendingAgent":t=t.filter(n=>(n==null?void 0:n.agentFigure)==="yes"&&(n==null?void 0:n.ticketmco)!=="ticketMco");break;case"todayPending":t=t.filter(n=>new Date(n.createdAt).toISOString().split("T")[0]===s&&(n==null?void 0:n.bidStatus)==="pending"&&(n==null?void 0:n.agentFigure)==="no");break;case"allPending":t=t.filter(n=>(n==null?void 0:n.bidStatus)==="pending"&&(n==null?void 0:n.agentFigure)==="no");break}}let i=t;f&&(i=i.filter(s=>new Date(s.createdAt)>=new Date(J(f)))),y&&(i=i.filter(s=>new Date(s.createdAt)<=new Date(V(y)))),k.trim()&&(i=i.filter(s=>{var n;return(n=s.bookingId)==null?void 0:n.includes(k.trim())}));const h=s=>{if(!s)return null;const n=s.agent;if(n&&typeof n=="object"&&!Array.isArray(n))return n._id||n.id||null;if(Array.isArray(n)&&n.length>0){const a=n[0];if(a&&typeof a=="object")return a._id||a.id||null;if(typeof a=="string")return a}return n!=null?String(n):null};d&&(i=i.filter(s=>{const n=h(s);return n&&String(n)===String(d)})),N(i)},v=()=>{A(null),C(null),I(""),N(c||[]),D(null)},o=t=>{if(t===S)return;D(t);let i;const h=new Date().toISOString().split("T")[0];switch(t){case"today":i=(c||[]).filter(s=>new Date(s.createdAt).toISOString().split("T")[0]===h);break;case g:i=(c||[]).filter(s=>(s==null?void 0:s.ticketmco)===g);break;default:i=c||[]}N(i),u(1)},T=t=>u(t);r.useEffect(()=>{if(m.length>0){const t=Math.ceil(m.length/b);l>t?u(t):l<1&&u(1)}else u(1)},[l,m,b]);const F=Math.ceil(m.length/b),_=(l-1)*b,P=m.slice(_,_+b),U=m.filter(t=>(t==null?void 0:t.ticketmco)===g).length;return r.useEffect(()=>{D(d?"filterByAgent":null),u(1)},[d]),e.jsx(K,{children:e.jsxs("main",{className:"crm_all_body d-flex",children:[e.jsx(G,{todayDealsCount:U}),e.jsxs("div",{className:"crm_right relative",children:[e.jsx("div",{className:"header_crm flex_props justify-content-between",children:e.jsx("p",{className:"crm_title mb_3",children:"Complete list of total BIDS..."})}),e.jsxs("div",{className:"mb-2 tabs_list_all",children:[e.jsxs("button",{type:"button",className:"todays_booking",onClick:()=>o("today"),children:[e.jsx("span",{children:(c||[]).filter(t=>new Date(t.createdAt).toISOString().split("T")[0]===new Date().toISOString().split("T")[0]).length}),"Today's Booking:"]}),e.jsxs("button",{type:"button",className:"under_follow_btn",onClick:()=>o(g),children:[e.jsx("span",{children:(c||[]).filter(t=>(t==null?void 0:t.ticketmco)===g).length}),"Under Follow Up:"]}),e.jsxs("button",{type:"button",className:"under_follow_btn",onClick:()=>o("todayUnderFollowUp"),children:[e.jsx("span",{children:(c||[]).filter(t=>{const i=new Date().toISOString().split("T")[0];return new Date(t.createdAt).toISOString().split("T")[0]===i&&(t==null?void 0:t.ticketmco)===g}).length}),"Today's Under Follow Up"]}),e.jsxs("button",{type:"button",className:"mco_charged_btn",onClick:()=>o(x),children:[e.jsx("span",{children:(c||[]).filter(t=>(t==null?void 0:t.ticketmco)===x).length}),"Ticketed & MCO Charged"]}),e.jsxs("button",{type:"button",className:"mco_charged_btn",onClick:()=>o("todayTicketMco"),children:[e.jsx("span",{children:(c||[]).filter(t=>{const i=new Date().toISOString().split("T")[0];return new Date(t.createdAt).toISOString().split("T")[0]===i&&(t==null?void 0:t.ticketmco)===x}).length}),"Today's Ticketed / MCO Charged"]}),e.jsxs("button",{type:"button",className:"mco_charged_btn  cancellation_btn",onClick:()=>o(p),children:[e.jsx("span",{children:(c||[]).filter(t=>(t==null?void 0:t.ticketmco)===p).length}),"Cancelled Booking"]}),e.jsxs("button",{type:"button",className:"todays_booking cancellation_btn",onClick:()=>o("todayCancelled"),children:[e.jsx("span",{children:(c||[]).filter(t=>{const i=new Date().toISOString().split("T")[0];return new Date(t.createdAt).toISOString().split("T")[0]===i&&(t==null?void 0:t.ticketmco)===p}).length}),"Today's Cancelled Booking"]}),e.jsxs("button",{type:"button",className:"pending_bookingg",onClick:()=>o("todayPendingAgent"),children:[e.jsx("span",{children:(c||[]).filter(t=>{const i=new Date().toISOString().split("T")[0];return new Date(t.createdAt).toISOString().split("T")[0]===i&&(t==null?void 0:t.agentFigure)==="yes"&&(t==null?void 0:t.ticketmco)!=="ticketMco"}).length}),"Today's Sent Invoice by Agent"]}),e.jsxs("button",{type:"button",className:"pending_bookingg",onClick:()=>o("allPendingAgent"),children:[e.jsx("span",{children:(c||[]).filter(t=>(t==null?void 0:t.agentFigure)==="yes"&&(t==null?void 0:t.ticketmco)!=="ticketMco").length}),"All Sent Invoice by Agent"]}),e.jsxs("button",{type:"button",className:"pending_bookingg",onClick:()=>o("todayPending"),children:[e.jsx("span",{children:(c||[]).filter(t=>{const i=new Date().toISOString().split("T")[0];return new Date(t.createdAt).toISOString().split("T")[0]===i&&(t==null?void 0:t.bidStatus)==="pending"&&(t==null?void 0:t.agentFigure)==="no"}).length}),"Today's Pending BID Status"]}),e.jsxs("button",{type:"button",className:"pending_bookingg",onClick:()=>o("allPending"),children:[e.jsx("span",{children:(c||[]).filter(t=>(t==null?void 0:t.bidStatus)==="pending"&&(t==null?void 0:t.agentFigure)==="no").length}),"All Pending BID Status"]}),e.jsxs("button",{type:"button",className:"todays_booking",onClick:v,children:[e.jsx("span",{children:c==null?void 0:c.length}),"All Bookings"]}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{htmlFor:"agentSelect",children:[e.jsx("img",{src:"/imgs/search-icon.png"}),"Select Agent"]}),e.jsxs("select",{id:"agentSelect",className:"form-control",value:d,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Agent --"}),j==null?void 0:j.map(t=>e.jsx("option",{value:t._id,children:t.userName},t._id))]})]})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex_props justify-content-between mt-3 mb-2",children:[e.jsx("p",{className:"crm_title mb-0",children:"Filter By :"}),e.jsxs("button",{className:"clear_filter",onClick:v,children:[e.jsx("img",{src:"/imgs/clear-filter.png"}),"Clear Filters"]})]}),e.jsxs("div",{className:"row bid_cont",children:[e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{htmlFor:"",children:[e.jsx("img",{src:"/imgs/search-icon.png"}),"Search by Bid No, Email, or Phone"]}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Booking ID",value:k,onChange:t=>I(t.target.value)})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{htmlFor:"",children:[e.jsx("img",{src:"/imgs/date-icon.png"}),"Date From"]}),e.jsx(O,{selected:f,onChange:t=>A(t),placeholderText:"Enter Pickup Date",dateFormat:"MM-dd-yyyy",className:"form-control",maxDate:new Date,name:"startDate",id:"start-date"})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{htmlFor:"",children:[e.jsx("img",{src:"/imgs/date-icon.png"}),"Date To"]}),e.jsx(O,{selected:y,onChange:t=>C(t),placeholderText:"Enter Pickup Date",dateFormat:"MM-dd-yyyy",className:"form-control",maxDate:new Date,name:"endDate",id:"start-date"})]})})]})]}),e.jsx("div",{className:"bid_table",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S. No."}),e.jsx("th",{children:"BID"}),e.jsx("th",{children:"Reservation date"}),e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Mobile"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:P.length?P.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:_+i+1}),e.jsx("td",{children:t.bookingId}),e.jsx("td",{children:new Date(t.outboundSegments[0].departure).toLocaleDateString()}),e.jsx("td",{children:t.cchName}),e.jsx("td",{children:t.billingPhoneNumber}),e.jsx("td",{children:t.email}),e.jsx("td",{children:e.jsx("div",{className:"flex_props justify-content-center",children:e.jsx($,{to:`/astrivion/details-pnr-flight/${t._id}`,className:"btn_common_c",children:"View PNR"})})}),e.jsx("td",{children:e.jsx("span",{className:`text_cap ${t.ticketmco==="ticketMco"?"text-success":t.ticketmco==="underFollowUp"?"text-warning":(t==null?void 0:t.ticketmco)==="cancelled"?"text-danger":"text-warning"}`,children:t.ticketmco||"Pending"})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center",children:M?"Loading...":w||"No flight deals available."})})})]})})}),e.jsxs("div",{className:"pagination mt-3",children:[e.jsx("button",{className:"btn btn-secondary mx-1",onClick:()=>T(l-1),disabled:l<=1,children:"Prev"}),Array.from({length:3},(t,i)=>{const h=i-0,s=l+h;return s<1||s>F?null:e.jsx("button",{className:`btn ${l===s?"btn-primary":"btn-secondary"} mx-1`,onClick:()=>T(s),children:s},s)}),e.jsx("button",{className:"btn btn-secondary mx-1",onClick:()=>T(l+1),disabled:l>=F,children:"Next"})]})]})]})})};export{nt as default};
