import{u as E,r as i,j as e,b as R}from"./index-DDoEHnfR.js";import{L}from"./Layout-Co7qzEc2.js";import{S as H}from"./SideBar-DCoEgSRU.js";import{f as C}from"./formatUTC-BuynropG.js";import{u as f,w as T,F as q}from"./FileSaver.min-czPidsmy.js";const J=()=>{var w;const{auth:j,setAuth:Q}=E(),[p,k]=i.useState([]),[g,A]=i.useState([]),[B,F]=i.useState([]),[c,b]=i.useState("All"),[d,N]=i.useState(""),[h,v]=i.useState(""),[m,D]=i.useState("All"),x=(w=j==null?void 0:j.user)==null?void 0:w.role;console.log("upcoming roles is ",x),i.useEffect(()=>{(async()=>{var n;try{const l=await R.get("/api/v1/auth/all-voice-records");let o=((n=l==null?void 0:l.data)==null?void 0:n.data)||[];x==="marketing"&&(o=o.filter(s=>s.bhAd==="AD")),k(o),A(o);const a=[...new Set(o.map(s=>{var r;return(r=s.agent)==null?void 0:r.userName}))];F(a)}catch(l){console.error("Error fetching voice records:",l)}})()},[x]);const y=t=>{b(t),u(t,d,h,m)},u=(t=c,n=d,l=h,o=m)=>{let a=[...p];t!=="All"&&(a=a.filter(s=>{var r;return((r=s.agent)==null?void 0:r.userName)===t})),n&&(a=a.filter(s=>new Date(s.createdAt)>=new Date(n))),l&&(a=a.filter(s=>new Date(s.createdAt)<=new Date(l))),o!=="All"&&(a=a.filter(s=>s.bhAd===o)),A(a)},_=()=>{b("All"),N(""),v(""),D("All"),A(p)},V=()=>{const t=g.map((s,r)=>{var S;return{"S.No":r+1,Date:new Date(s.date).toLocaleDateString(),Agent:((S=s.agent)==null?void 0:S.userName)||"Unknown","TFN No":s.tfnNo,"Customer No":s.customerNo,Airline:s.airline,"BH/AD":s.bhAd,Language:s.language,Conversion:s.conversion,Query:s.query,"Created At":C(s.createdAt)}}),n=f.json_to_sheet(t),l=f.book_new();f.book_append_sheet(l,n,"Voice Records");const o=T(l,{bookType:"xlsx",type:"array"}),a=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});q.saveAs(a,"Voice_Records.xlsx")};return e.jsx(L,{children:e.jsxs("main",{className:"crm_all_body d-flex",children:[e.jsx(H,{}),e.jsxs("div",{className:"crm_right relative p-4",children:[e.jsx("h2",{className:"mb-3",children:"Voice Record"}),e.jsx("button",{onClick:V,className:"btn btn-success mb-3",children:"Download Excel"}),e.jsxs("div",{className:"d-flex flex-wrap mb-3 align-items-center",children:[e.jsx("label",{className:"me-2",children:"From:"}),e.jsx("input",{type:"date",className:"form-control me-2",value:d,onChange:t=>{N(t.target.value),u(c,t.target.value,h,m)}}),e.jsx("label",{className:"me-2",children:"To:"}),e.jsx("input",{type:"date",className:"form-control me-2",value:h,onChange:t=>{v(t.target.value),u(c,d,t.target.value,m)}}),x==="superadmin"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"me-2",children:"BH/AD:"}),e.jsxs("select",{className:"form-control me-2",value:m,onChange:t=>{D(t.target.value),u(c,d,h,t.target.value)},children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"BH",children:"BH"}),e.jsx("option",{value:"AD",children:"AD"})]})]}),e.jsx("button",{className:"btn btn-warning",onClick:_,children:"Clear Filters"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("button",{onClick:()=>y("All"),className:`btn me-2 ${c==="All"?"btn-primary":"btn-outline-primary"}`,children:"All"}),B.map((t,n)=>e.jsx("button",{onClick:()=>y(t),className:`btn me-2 ${c===t?"btn-primary":"btn-outline-primary"}`,children:t},n))]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Agent"}),e.jsx("th",{children:"TFN No"}),e.jsx("th",{children:"Customer No"}),e.jsx("th",{children:"Airline"}),e.jsx("th",{children:"BH/AD"}),e.jsx("th",{children:"Language"}),e.jsx("th",{children:"Conversion"}),e.jsx("th",{children:"Query"}),e.jsx("th",{children:"Created At"})]})}),e.jsx("tbody",{children:g.map((t,n)=>{var l;return e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsx("td",{children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{children:((l=t.agent)==null?void 0:l.userName)||"Unknown"}),e.jsx("td",{children:t.tfnNo}),e.jsx("td",{children:t.customerNo}),e.jsx("td",{children:t.airline}),e.jsx("td",{children:t.bhAd}),e.jsx("td",{children:t.language}),e.jsx("td",{children:t.conversion}),e.jsx("td",{children:t.query}),e.jsx("td",{children:C(t.createdAt)})]},t._id)})})]})})]})]})})};export{J as default};
