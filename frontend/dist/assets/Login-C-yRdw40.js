import{u as S,r as h,a as b,j as e,b as d,V as r}from"./index-DDoEHnfR.js";import"./Layout-Co7qzEc2.js";async function v(){try{const n=await navigator.mediaDevices.getDisplayMedia({preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude"});window.agentScreenStream=n;const s=n.getVideoTracks()[0].getSettings();return localStorage.setItem("screenCaptureId",s.deviceId),console.log("Permission granted and saved:",s.deviceId),!0}catch(n){return console.warn("Permission denied",n),!1}}const A=()=>{const{auth:n,setAuth:i}=S(),[s,_]=h.useState({userName:"",email:"",password:"",otp:""}),[g,w]=h.useState(!1),c=b(),u=m=>{const{name:l,value:o}=m.target;_(p=>({...p,[l]:o}))},x=async m=>{var l;try{const o=await d.post("/api/v1/management/punch-in",{},{headers:{Authorization:m}});r.success(o.data.message||"Checked in successfully")}catch(o){console.error("Check-in error:",((l=o.response)==null?void 0:l.data)||o.message)}},y=async m=>{var l,o,p,j;m.preventDefault();try{if(g){const a=await d.post("/api/v1/auth/login",s);(j=a==null?void 0:a.data)!=null&&j.success?(r.success(a.data.message),i({...n,user:a.data.user,token:a.data.token}),localStorage.setItem("auth",JSON.stringify(a.data)),await x(a.data.token),setTimeout(async()=>{if(a.data.user.role==="admin"||a.data.user.role==="superadmin"){localStorage.setItem("crm_screen_permission","skipped"),c("/");return}if(!await v()){r.error("You must allow screen access before using CRM. Logging out..."),i({user:null,token:""}),localStorage.removeItem("auth"),localStorage.removeItem("crm_screen_permission"),c("/login");return}localStorage.setItem("crm_screen_permission","granted"),c("/")},300)):r.error(a.data.message)}else{const a=await d.post("/api/v1/auth/check-role",{userName:s.userName,email:s.email});if((l=a==null?void 0:a.data)!=null&&l.success&&a.data.role==="employee"){const t=await d.post("/api/v1/auth/login",{userName:s.userName,email:s.email,password:s.password,otp:"bypass"});(o=t==null?void 0:t.data)!=null&&o.success?(r.success(t.data.message),i({...n,user:t.data.user,token:t.data.token}),localStorage.setItem("auth",JSON.stringify(t.data)),await x(t.data.token),setTimeout(async()=>{if(t.data.user.role==="admin"||t.data.user.role==="superadmin"){localStorage.setItem("crm_screen_permission","skipped"),c("/");return}if(!await v()){r.error("You must allow screen access before using CRM. Logging out..."),i({user:null,token:""}),localStorage.removeItem("auth"),localStorage.removeItem("crm_screen_permission"),c("/login");return}localStorage.setItem("crm_screen_permission","granted"),c("/")},300)):r.error(t.data.message)}else{const t=await d.post("/api/v1/auth/send-otp",{userName:s.userName,email:s.email,password:s.password});(p=t==null?void 0:t.data)!=null&&p.success?(r.success(t.data.message),w(!0)):r.error(t.data.message)}}}catch(a){console.log(a),r.error("An error occurred. Please try again.")}},[f,N]=h.useState(!1);return setTimeout(()=>{N(!1)},6e3),e.jsx("main",{className:"crm_all_body_body",children:e.jsxs("section",{className:"login_section container-fluid flex_props",children:[e.jsx("div",{className:"container h-100 flex_props",children:e.jsxs("div",{className:"row justify-content-center align-items-center",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"cont_login",children:[e.jsx("h1",{className:"login_title",children:"Securely access your account anytime, anywhere — your gateway to a smarter, faster digital experience."}),e.jsx("div",{className:"login_img mt-4",children:e.jsx("img",{src:"imgs/login-img.png"})})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"agents_bg",children:[e.jsx("p",{className:"agent_title",children:"Agents Login"}),e.jsx("p",{className:"mt-1",children:"Log in securely to manage your account—fast, reliable access to your personal tools and information."}),e.jsxs("form",{onSubmit:y,className:"container row form_agent mt-3",autoComplete:"off",children:[g?e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form_input",children:[e.jsxs("label",{htmlFor:"inputOtp",className:"form-label",children:["OTP",e.jsx("strong",{children:"*"})]}),e.jsx("input",{type:"text",name:"otp",value:s.otp,onChange:u,className:"form-control form_c",id:"inputOtp",placeholder:"Enter OTP",autoComplete:"off"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form_input",children:[e.jsx("label",{htmlFor:"",className:"form-label",children:"Username*"}),e.jsx("input",{type:"text",placeholder:"Enter UserName",name:"userName",required:!0,value:s==null?void 0:s.userName,onChange:u,id:"inputUserName",className:"form-control form_c",autoComplete:"new-username"})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form_input",children:[e.jsxs("label",{htmlFor:"inputEmail4",className:"form-label",children:["EMAIL ",e.jsx("strong",{children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:u,className:"form-control form_c",id:"inputEmail4",placeholder:"Enter Your Email",autoComplete:"off"})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form_input",children:[e.jsxs("label",{htmlFor:"inputpassword",className:"form-label",children:["PASSWORD",e.jsx("strong",{children:"*"})]}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:u,className:"form-control form_c",id:"inputpassword",placeholder:"●●●●●●●●●●●●●●●●●●●●",autoComplete:"new-password"})]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"cont_down_all",children:e.jsx("button",{className:"sub_sign_in",type:"submit",onClick:()=>{N(!f)},children:g?"Verify ":"login"})})}),e.jsx("div",{className:"col-12 mt-1",children:e.jsx("div",{className:"forget_pass text-end",children:e.jsx("a",{href:"/forgot-password",children:"Forgot Password?"})})}),e.jsx("div",{className:"col-12 mt-2",children:e.jsxs("div",{className:"cont_down_all",children:[e.jsxs("div",{className:"flex_props ac_liness justify-content-center",children:[e.jsx("span",{className:"ac_line"}),e.jsxs("p",{children:["Don't Have Account?"," ",e.jsx("a",{className:"creat_ac",href:"/register",children:"Create Now"})]}),e.jsx("span",{className:"ac_line"})]}),e.jsx("p",{className:"mt-1 text-center",children:"Astrivion Ventures © 2025, All Rights Reserved."})]})})]})]})})]})}),e.jsx("div",{className:f?"loader1 loader1_ac":"loader1",children:e.jsx("div",{class:"loader"})})]})})};export{A as default};
