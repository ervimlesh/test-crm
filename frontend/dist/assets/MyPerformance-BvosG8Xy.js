import{e as E,f as R,r as l,j as e}from"./index-DDoEHnfR.js";import{L as A}from"./Layout-Co7qzEc2.js";import{S as C}from"./SideBar-DCoEgSRU.js";import{D as M}from"./index.es-_Aq59fjB.js";import{t as I,a as L}from"./formatUTC-BuynropG.js";import"./clsx-B-dksMZM.js";const V=()=>{const{agent:u}=E(),{ctmFlightDeals:o,fetchCtmFlightDeals:g}=R(),[O,p]=l.useState(null),[N,b]=l.useState([]),[x,v]=l.useState(null),[j,S]=l.useState(null),[w,_]=l.useState(!1),[B,y]=l.useState(!0),[a,F]=l.useState(""),[m,D]=l.useState(""),[f,k]=l.useState(""),c=l.useMemo(()=>{const t=localStorage.getItem("auth"),i=t?JSON.parse(t):null;return i==null?void 0:i.user},[]);l.useEffect(()=>{y(!0),g().finally(()=>y(!1))},[]),console.log("CTM Flight Deals:",o),l.useEffect(()=>{var d;if(!c||!(o!=null&&o.length))return;let t=0,i=0,n=[];o.forEach(r=>{if(!(r!=null&&r.agent))return;const s=typeof r.agent=="object"?r.agent._id:r.agent;(a?s===a:s===c._id)&&(t+=1,i+=Number(r==null?void 0:r.taxes)||0,typeof r.agent=="object"&&Array.isArray(r.agent.userPictures)&&n.push(...r.agent.userPictures))}),p({userName:a?((d=u.find(r=>r._id===a))==null?void 0:d.userName)||"Agent":c.userName||"You",userPictures:n,count:t,totalPrice:i})},[o,c==null?void 0:c._id,c==null?void 0:c.userName,a,u]);const P=(t,i)=>{if(!i)return!0;const n=t==null?void 0:t[i];return n?!!(n._id||typeof n=="object"&&Object.keys(n).length>0||typeof n=="string"&&n.trim()!==""):!1},H=()=>{const t=x?I(x):null,i=j?L(j):null,n=(o||[]).filter(s=>{const h=typeof s.agent=="object"?s.agent._id:s.agent;if(!(a?h===a:h===c._id))return!1;if(t&&i){const T=new Date(s.createdAt);if(!(T>=t&&T<=i))return!1}if(m){if(m==="ticketMco"){if(!(s!=null&&s.ticketmco)!=="ticketMco"||String(s.ticketmco).trim()==="")return!1}else if(m==="cancelled"){if(String(s.ticketmco)!=="cancelled")return!1}else if(m==="underFollowUp"){if(String(s.ticketmco)!=="underFollowUp")return!1}else if(String(s.bidStatus)!==String(m))return!1}return!(f&&!P(s,f))});let d=n.length,r=n.reduce((s,h)=>s+Number(h.taxes||0),0);b(n),p(s=>({...s,count:d,totalPrice:r})),_(!0)},U=()=>{v(null),S(null),_(!1),F(""),D(""),k(""),b([]),g()};return B?e.jsx(A,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(C,{}),e.jsxs("div",{className:"flex-grow-1 p-4",children:[e.jsx("h2",{className:"mb-4",children:"My Performance"}),e.jsx("p",{children:"Loading data..."})]})]})}):e.jsx(A,{children:e.jsxs("main",{className:"crm_all_body d-flex",children:[e.jsx(C,{}),e.jsxs("div",{className:"crm_right relative",children:[e.jsx("div",{className:"header_crm flex_props justify-content-between",children:e.jsx("p",{className:"crm_title mb_3",children:"My Performance"})}),e.jsx("div",{className:"bid_bg",children:e.jsxs("div",{className:"bid_table",children:[e.jsxs("div",{className:"row bid_cont",children:[e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{children:[e.jsx("img",{src:"/imgs/date-icon.png",alt:"from"})," From"]}),e.jsx(M,{selected:x,onChange:t=>v(t),placeholderText:"Select From Date ",showTimeSelect:!0,timeFormat:"HH:mm",dateFormat:"yyyy-MM-dd HH:mm:ss",className:"form-control",maxDate:new Date})]})}),e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{children:[e.jsx("img",{src:"/imgs/date-icon.png",alt:"to"})," To"]}),e.jsx(M,{selected:j,onChange:t=>S(t),placeholderText:"Select To Date ",showTimeSelect:!0,timeFormat:"HH:mm",dateFormat:"yyyy-MM-dd HH:mm:ss",className:"form-control",maxDate:new Date})]})}),e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{children:[e.jsx("img",{src:"/imgs/date-icon.png",alt:"agent"})," Agent"]}),e.jsxs("select",{className:"form-control",value:a,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"",children:"Select Agent"}),u.map(t=>e.jsx("option",{value:t._id,children:t.userName},t._id))]})]})}),e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{children:[e.jsx("img",{src:"/imgs/date-icon.png",alt:"bidStatus"})," Bid Status"]}),e.jsxs("select",{className:"form-control",value:m,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"",children:" Select Bid Status "}),e.jsx("option",{value:"pending",children:" pending "}),e.jsx("option",{value:"cancelled",children:" cancelled "}),e.jsx("option",{value:"rejected",children:" rejected "}),e.jsx("option",{value:"ticketMco",children:" ticketMco "}),e.jsx("option",{value:"underFollowUp",children:" underFollowUp "})]})]})}),e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"bids_inn_fresh",children:[e.jsxs("label",{children:[e.jsx("img",{src:"/imgs/date-icon.png",alt:"txn"})," Transaction Type"]}),e.jsxs("select",{className:"form-control",value:f,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:" Select Transaction Type "}),e.jsx("option",{value:"refund",children:" Refund Details "}),e.jsxs("option",{value:"chargeBackDetails",children:[" ","ChargeBack Details"," "]})]})]})}),e.jsx("div",{className:"col-2 ps-2",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-5 pe-1",children:e.jsx("button",{className:"btn_apply apply_filter",onClick:H,children:"Apply"})}),e.jsx("div",{className:"col-5 ps-1",children:e.jsx("button",{className:"btn_apply reset_btn",onClick:U,children:"Reset"})})]})})]}),e.jsx("div",{className:"bid_table",children:w?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Booking ID"}),e.jsx("th",{children:"PNR Status"}),e.jsx("th",{children:"Bid Status"}),e.jsx("th",{children:"Refund"}),e.jsx("th",{children:"ChargeBack"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:N.length>0?N.map((t,i)=>{var n,d;return e.jsxs("tr",{children:[e.jsx("td",{children:t.bookingId}),e.jsx("td",{children:t.pnrStatus}),e.jsx("td",{children:t.bidStatus}),e.jsx("td",{children:(n=t.refund)!=null&&n._id?"Yes":"No"}),e.jsx("td",{children:(d=t.chargeBackDetails)!=null&&d._id?"Yes":"No"}),e.jsxs("td",{children:["â‚¹",Number(t.taxes||0).toFixed(2)]})]},i)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No Booking Found"})})})]})}):e.jsx("p",{children:"hei"})})]})})]})]})})};export{V as default};
