import{r as l,j as s,N as y,b as g,V as u}from"./index-DDoEHnfR.js";import{L as $}from"./Layout-Co7qzEc2.js";import{S as A}from"./SideBar-DCoEgSRU.js";const T=()=>{const[f,n]=l.useState(""),[v,i]=l.useState(""),[D,o]=l.useState(!1),[w,d]=l.useState(!1),[h,S]=l.useState([]),[m,N]=l.useState([]),[p,c]=l.useState({source:"",destination:"",reducePercentage:"",reduceUrl:""}),[x,C]=l.useState([]),_=()=>{!m.some(e=>e===f)&&m.length>0&&(n(m[0]),c(e=>({...e,source:m[0]}))),o(!1)},k=()=>{n(""),N([]),o(!1)},F=()=>{!h.some(e=>e===v)&&h.length>0&&(i(h[0]),c(e=>({...e,destination:h[0]}))),d(!1)},U=()=>{i(""),S([]),d(!1)},P=a=>{n(a),c(e=>({...e,source:a})),o(!1)},E=a=>{i(a),c(e=>({...e,destination:a})),d(!1)},I=async a=>{const e=a.target.value;if(n(e),c(t=>({...t,source:e})),e.length>=1)try{const t=await g.get(`/api/v1/flights/locations?keyword=${e}`);N(t.data),o(!0)}catch(t){console.error("Error fetching locations:",t)}else o(!1)},B=async a=>{const e=a.target.value;if(i(e),c(t=>({...t,destination:e})),e.length>=1)try{const t=await g.get(`/api/v1/flights/locations?keyword=${e}`);S(t.data),d(!0)}catch(t){console.error("Error fetching locations:",t)}else d(!1)},b=a=>{const{id:e,value:t}=a.target;c(r=>({...r,[e]:t}))},R=async a=>{a.preventDefault();try{console.log(p);const e=await g.patch("/api/v1/flights/reduction-percentage-srcDest/",p);e.data.success?(u.success(e.data.message),c({source:"",destination:"",reducePercentage:"",reduceUrl:""}),n(""),i(""),j()):u.error(e.data.message)}catch(e){console.error("Error updating reduction percentage:",e),e.response&&e.response.data&&e.response.data.message?u.error(e.response.data.message):alert("Failed to update reduction percentage. Please try again.")}},j=async()=>{var a;try{const e=await g.get("/api/v1/flights/get-reduction-percentage");e.data.success?C((a=e==null?void 0:e.data)==null?void 0:a.data):console.error("Failed to fetch current reduction percentage.")}catch(e){console.error("Error fetching current reduction percentage:",e)}};l.useEffect(()=>{j()},[]);const V=async a=>{var e,t;try{const r=await g.delete(`/api/v1/flights/delete-src-dest/${a}`);console.log(r),(e=r==null?void 0:r.data)!=null&&e.success&&(u.success((t=r==null?void 0:r.data)==null?void 0:t.message),j())}catch(r){console.log(r)}},L=l.useMemo(()=>{const a=x.map(e=>e==null?void 0:e.reduceUrl).filter(Boolean);return[...new Set(a)]},[x]),q=a=>{if(!a)return"Other";const e=a.replace(".com","");return e.charAt(0).toUpperCase()+e.slice(1)};return s.jsx($,{children:s.jsxs("div",{className:"d-flex",children:[s.jsx(A,{}),s.jsxs("div",{className:"flex-grow-1 p-4",children:[s.jsx("h3",{className:"text-center",children:"Src-Dest"}),s.jsxs("form",{onSubmit:R,className:"form_booking",children:[s.jsxs("div",{className:"form_booking",children:[s.jsxs("div",{className:"form_holdd text-start relative",children:[s.jsx("label",{htmlFor:"source",children:"Source"}),s.jsx("input",{type:"text",id:"source",onChange:I,value:f,onBlur:_,onFocus:k,className:"form-control",required:!0,placeholder:"Search airports"}),s.jsx("div",{className:"listing_airport_ul",children:D&&s.jsx("ul",{className:"autoSugge-ul",children:m.map(a=>s.jsxs("li",{className:"autoSuggestData cursor-pointer",onClick:()=>P(a),children:[s.jsx("span",{className:"listing_airport_icon",children:s.jsx("img",{src:"/imgs/airline-img.png",alt:""})}),s.jsx("span",{children:a})]},a))})})]}),s.jsxs("div",{className:"form_holdd text-start relative",children:[s.jsx("label",{htmlFor:"destination",children:"Dest"}),s.jsx("input",{type:"text",id:"destination",onChange:B,value:v,onBlur:F,onFocus:U,className:"form-control",required:!0,placeholder:"Search airports"}),s.jsx("div",{className:"listing_airport_ul",children:w&&s.jsx("ul",{className:"autoSugge-ul",children:h.map(a=>s.jsxs("li",{className:"autoSuggestData cursor-pointer",onClick:()=>E(a),children:[s.jsx("span",{className:"listing_airport_icon",children:s.jsx("img",{src:"/imgs/airline-img.png",alt:""})}),s.jsx("span",{children:a})]},a))})})]}),s.jsxs("label",{htmlFor:"reducePercentage",children:["Discount ",s.jsx("span",{children:"*"})]}),s.jsx("div",{className:"form_input",children:s.jsx("input",{type:"number",maxLength:"3",id:"reducePercentage",value:p.reducePercentage,onChange:b,required:!0,placeholder:"Enter reduction percentage",className:"form-control",min:"0",max:"100"})}),s.jsxs("div",{className:"col-md-9 mb-3",children:[s.jsx("label",{htmlFor:"reduceUrl",className:"form-label",children:"Reduce Url"}),s.jsxs("select",{id:"reduceUrl",className:"form-select",value:p.reduceUrl,onChange:b,required:!0,children:[s.jsx("option",{value:"",children:"Select"}),s.jsx("option",{value:"faresway.com",children:"Faresway"}),s.jsx("option",{value:"traveloways.com",children:"Traveloways"}),s.jsx("option",{value:"faresvilla.com",children:"Faresvilla"})]})]})]}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"d-flex justify-content-between align-items-center p-2 bg-light",children:s.jsx("h7",{className:"m-1 p-1 ",children:"Current Discount"})}),s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"table-responsive",children:L.map(a=>s.jsxs("div",{className:"mb-4",children:[s.jsx("h5",{className:"text-start text-success fw-bold text-uppercase mt-3",children:q(a)}),s.jsxs("table",{className:"table table-bordered",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Src-Dest Percentage"}),s.jsx("th",{children:"Source"}),s.jsx("th",{children:"Destination"}),s.jsx("th",{children:"Action"})]})}),s.jsx("tbody",{children:x.filter(e=>(e==null?void 0:e.reduceSrcDestPercentage)&&(e==null?void 0:e.reduceSrc)&&(e==null?void 0:e.reduceDest)&&(e==null?void 0:e.reduceUrl)===a).length>0?x.filter(e=>(e==null?void 0:e.reduceSrcDestPercentage)&&(e==null?void 0:e.reduceSrc)&&(e==null?void 0:e.reduceDest)&&(e==null?void 0:e.reduceUrl)===a).map((e,t)=>s.jsxs("tr",{children:[s.jsxs("td",{children:[(e==null?void 0:e.reduceSrcDestPercentage)||"-"," %"]}),s.jsx("td",{children:(e==null?void 0:e.reduceSrc)||"-"}),s.jsx("td",{children:(e==null?void 0:e.reduceDest)||"-"}),s.jsxs("td",{className:"d-flex gap-1",children:[s.jsx(y,{to:`/astrivion/src-dest-details/${e==null?void 0:e._id}`,className:"btn btn-primary btn-sm",children:"Edit"}),s.jsx(y,{className:"btn btn-danger btn-sm",onClick:()=>{V(e==null?void 0:e._id)},children:"Delete"})]})]},(e==null?void 0:e._id)||t)):s.jsx("tr",{children:s.jsx("td",{colSpan:"5",className:"text-center",children:"No reduction data for this Reduction Url."})})})]})]},a))})})]})]})]})})};export{T as default};
