import{j as e,b as j,r as d,V as g,u as M}from"./index-DDoEHnfR.js";import{L as T}from"./Layout-Co7qzEc2.js";import{S as P}from"./SideBar-DCoEgSRU.js";import{G as R,H as $}from"./index-Dn2aN8CX.js";function H(r){return R({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(r)}const I=({sprThrash:r,setShowModal:h,onClose:m,onMoveToTrashSuccess:l})=>{const u=async c=>{try{await j.patch(`/api/v1/auth/moveToTrash/${c}`),h(!1),l&&l(c)}catch(p){console.log(p)}};return e.jsx("div",{className:"popup-overlay",children:e.jsx("div",{className:"popup-content",id:"printable-popup",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"h-14 w-14 text-gray-400 text-gray-200 mb-4 mx-auto"}),e.jsx("h3",{className:"mb-5 text-lg text-gray-500 dark:text-gray-400",children:"Are you sure you want to unregister this user"}),e.jsxs("div",{className:"d-flex justify-content-center gap-4",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>u(r),children:"Yes, Move to Trash"}),e.jsx("button",{className:"btn btn-warning",color:"gray",onClick:m,children:"No, Cancel"})]})]})})})},L=({user:r,onClose:h,onSuccess:m})=>{const[l,u]=d.useState({userName:"",email:"",number:"",role:"user",password:"",confirmPassword:""});d.useEffect(()=>{r&&u({userName:r.userName||"",email:r.email||"",number:r.number||"",role:r.role||"user",password:"",confirmPassword:""})},[r]);const c=i=>{u({...l,[i.target.name]:i.target.value})},p=async()=>{try{const i=await j.patch(`/api/v1/auth/update-super-admin-all-profile/${r._id}`,l);m(),i&&i.data.success&&g.success(i.data&&i.data.message),h()}catch(i){console.error("Error updating user:",i),alert("Update failed!")}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsxs("div",{className:"provider_semi_semi",id:"printable-popup",children:[e.jsx("h4",{className:"add_pr_title",children:"Edit User"}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-control form_in_pr",name:"userName",value:l.userName,onChange:c})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:c,className:"form-control form_in_pr",disabled:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Phone Number"}),e.jsx("input",{type:"text",name:"number",value:l.number,onChange:c,className:"form-control form_in_pr"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Role"}),e.jsxs("select",{name:"role",value:l.role,onChange:c,className:"form-control form_in_pr",children:[e.jsx("option",{value:"superadmin",children:"Superadmin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"agent",children:"Agent"}),e.jsx("option",{value:"user",children:"User"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"New Password"}),e.jsx("input",{type:"password",name:"password",value:l.password,onChange:c,className:"form-control form_in_pr",required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"confirmPassword",value:l.confirmPassword,onChange:c,className:"form-control form_in_pr",required:!0})]}),e.jsxs("div",{className:"flex_props gap-2 mt-3 justify-content-end",children:[e.jsx("button",{onClick:p,className:"btn_provider_pop btn_provider_pop_add",children:"Save"}),e.jsx("button",{onClick:h,className:"btn_provider_pop",children:"Cancel"})]})]})})},q=()=>{const{auth:r,logout:h}=M(),[m,l]=d.useState([]),[u,c]=d.useState(!1),[p,i]=d.useState(null),[y,f]=d.useState(!1),[w,x]=d.useState(!1),[S,C]=d.useState(null),[E,N]=d.useState(!1),A=()=>{x(!1)},U=n=>{l(m.filter(s=>s._id!==n)),x(!1)};d.useEffect(()=>{b()},[]);const b=async()=>{var n,s;c(!0),i(null);try{const o=await j.get("/api/v1/auth/get-all-users");console.log("newly console.log",o),l(o.data.getAllusers.filter(t=>!t.isTrashed))}catch(o){i(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong!")}finally{c(!1)}},v=async(n,s)=>{var o,t;try{const a=await j.patch(`/api/v1/auth/status/${n}`,{status:s});a&&((o=a==null?void 0:a.data)==null?void 0:o.status)==="rejected"&&n===((t=r==null?void 0:r.user)==null?void 0:t._id)&&(g.error("Your access has been removed. Logging out..."),h()),console.log("Status updated"),b()}catch(a){console.error("Error updating status:",a)}},_=["superadmin","admin","agent","marketing","account","hr","employee"],k=async(n,s)=>{var o,t;try{const a=await j.patch(`/api/v1/auth/update-role/${n}`,{role:s});a&&(a!=null&&a.data)&&((o=a==null?void 0:a.data)!=null&&o.succes)&&g.success((t=a==null?void 0:a.data)==null?void 0:t.message),console.log("Role updated successfully"),b()}catch(a){console.error("Error updating role:",a)}};return e.jsxs(T,{children:[e.jsxs("main",{class:"crm_all_body d-flex",children:[e.jsx(P,{}),e.jsxs("div",{className:"crm_right relative",children:[e.jsx("section",{className:"",children:e.jsx("div",{className:"header_crm flex_props justify-content-between",children:e.jsx("p",{className:"crm_title",children:"All Astrivion Ventures Teams"})})}),e.jsx("section",{className:"margin_minus_b",children:_.map(n=>e.jsxs("div",{className:"box_crm_tr margin_box_tr",children:[e.jsx("p",{className:"title_common_semi",children:n}),e.jsx("div",{className:"bid_bg mt-4",children:e.jsx("div",{className:"bid_table",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Number"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Edit User / Password"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:" Assign Role "})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"Loading..."})}):p?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:p})}):m.filter(s=>s.role===n).length>0?m.filter(s=>s.role===n).map((s,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:o+1}),e.jsx("td",{children:e.jsx("div",{children:s==null?void 0:s.userPictures.map(t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"img_team",children:e.jsx("img",{src:`http://localhost:8000/uploads/${t.img}`,alt:`${s.userName} Image missing`})})}))})}),e.jsx("td",{children:s.userName}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.number||"-"}),e.jsx("td",{children:s.status==="pending"?e.jsxs("div",{className:"flex_props justify-content-center gap-2",children:[e.jsx("button",{className:"btns_status btns_status_success",onClick:()=>v(s._id,"approved"),children:"Approve"}),e.jsx("button",{className:"btns_status reject_btt",onClick:()=>{x(!0),f(s._id)},children:"Reject"})]}):e.jsx("button",{className:s.status==="rejected"?"btns_status":"btns_status btns_status_success",onClick:()=>v(s._id,s.status==="approved"?"rejected":"approved"),children:s.status==="approved"?"Remove Access":"Grant Access"})}),e.jsx("td",{children:e.jsx("button",{className:"btns_status btns_status_success",onClick:()=>{C(s),N(!0)},children:"Edit"})}),s.email!=="srijha723@gmail.com"&&e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger",onClick:()=>{x(!0),f(s._id)},children:e.jsx(H,{})})}),e.jsx("td",{children:e.jsx("select",{value:s.role,onChange:t=>k(s._id,t.target.value),className:"form-select border px-2 py-1 rounded-md",children:_.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No users in this role."})})})]})})})})]},n))})]})]}),w&&e.jsx(I,{setShowModal:x,sprThrash:y,onClose:A,onMoveToTrashSuccess:U}),E&&e.jsx(L,{user:S,onClose:()=>N(!1),onSuccess:b})]})};export{q as default};
