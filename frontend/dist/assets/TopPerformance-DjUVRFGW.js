import{f as S,r as l,j as e}from"./index-DDoEHnfR.js";import{L as w}from"./Layout-Co7qzEc2.js";import{S as F}from"./SideBar-DCoEgSRU.js";const A=()=>{const{ctmFlightDeals:u,fetchCtmFlightDeals:_}=S(),[M,j]=l.useState([]),[p,N]=l.useState([]),[P,d]=l.useState([]),[v,k]=l.useState([]);l.useEffect(()=>{_()},[]);const D=(c,s)=>c.getDate()===s.getDate()&&c.getMonth()===s.getMonth()&&c.getFullYear()===s.getFullYear(),y=(c,s)=>{const n=(s.getDay()+6)%7,o=new Date(s);o.setHours(0,0,0,0),o.setDate(s.getDate()-n);const m=new Date(o);return m.setDate(o.getDate()+6),m.setHours(23,59,59,999),c>=o&&c<=m},b=(c,s)=>c.getMonth()===s.getMonth()&&c.getFullYear()===s.getFullYear();l.useEffect(()=>{if(!u||u.length===0)return;const c=new Date,s={},a={},n={},o={},m={};u.forEach(t=>{if(t.agent&&t.createdAt){const i=new Date(t.createdAt),r=typeof t.agent=="object"?t.agent._id:t.agent;typeof t.agent=="object"&&(m[r]={userName:t.agent.userName,userPictures:t.agent.userPictures}),s[r]||(s[r]={count:0,totalPrice:0}),s[r].count++,s[r].totalPrice+=Number(t==null?void 0:t.taxes)||0,D(c,i)&&(a[r]||(a[r]={count:0,totalPrice:0}),a[r].count++,a[r].totalPrice+=Number(t==null?void 0:t.taxes)||0),y(i,c)&&(n[r]||(n[r]={count:0,totalPrice:0}),n[r].count++,n[r].totalPrice+=Number(t==null?void 0:t.taxes)||0),b(c,i)&&(t==null?void 0:t.ticketmco)==="ticketMco"&&(o[r]||(o[r]={count:0,totalPrice:0}),o[r].count++,o[r].totalPrice+=Number(t==null?void 0:t.taxes)||0)}});const f=t=>Object.entries(t).map(([i,r])=>{var x,g;return{agentId:i,userName:((x=m[i])==null?void 0:x.userName)||"Unknown",userPictures:((g=m[i])==null?void 0:g.userPictures)||[],count:r.count,totalPrice:r.totalPrice}}).sort((i,r)=>r.totalPrice-i.totalPrice);j(f(s)),N(f(a)),d(f(n)),k(f(o))},[u]);const h=c=>!c||c.length===0?e.jsx("p",{children:"No data available."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"performer_grid mt-4",children:c.slice(0,3).map((s,a)=>e.jsxs("div",{className:"performer_container_main",children:[e.jsxs("div",{className:"performer_container text-center relative",children:[e.jsxs("div",{className:"performer_img2 relative",children:[s.userPictures.map((n,o)=>e.jsx("div",{children:e.jsx("img",{src:`http://localhost:8000/uploads/${n.img}`,alt:"agent"})},o)),e.jsxs("div",{className:"rank_cont",children:[e.jsx("p",{className:"rank_title",children:"#Rank"}),e.jsx("p",{children:a+1})]}),e.jsx("div",{className:"reward_icon",children:e.jsx("img",{src:"/imgs/reward-icon.png"})})]}),e.jsxs("div",{className:"performer_content text-center white",children:[e.jsx("p",{className:"perf_title",children:s.userName}),e.jsxs("p",{className:"per_profit",children:["With Avg. of"," ",e.jsx("span",{className:"profit_title",children:s.totalPrice.toFixed(2)})]})]})]}),e.jsx("div",{className:"performer_content_1 text-center",children:e.jsxs("span",{className:"performer_content_1_num",children:["No. Of Booking ",s.count]})})]},s.agentId))})});return e.jsx(w,{children:e.jsxs("main",{class:"crm_all_body d-flex",children:[e.jsx(F,{}),e.jsxs("div",{className:"crm_right relative",children:[e.jsxs("div",{className:"box_crm_tr",children:[e.jsx("p",{className:"title_common_semi",children:"Top Performers of the Day"}),h(p)]}),e.jsxs("div",{className:"box_crm_tr margin_box_tr",children:[e.jsx("p",{className:"title_common_semi",children:"Top Performers of Week"}),h(P)]}),e.jsxs("div",{className:"box_crm_tr margin_box_tr",children:[e.jsx("p",{className:"title_common_semi",children:"Top Performers of Current Month"}),h(v)]})]})]})})};export{A as default};
