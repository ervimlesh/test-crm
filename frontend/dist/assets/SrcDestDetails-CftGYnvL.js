import{h as R,a as $,r,j as e,b as m,V as g}from"./index-DDoEHnfR.js";import{L as N}from"./Layout-Co7qzEc2.js";import{S as y}from"./SideBar-DCoEgSRU.js";const A=()=>{const{id:p}=R(),D=$(),[x,l]=r.useState(""),[f,o]=r.useState(""),[w,i]=r.useState(!1),[b,d]=r.useState(!1),[u,j]=r.useState([]),[h,v]=r.useState([]),[n,c]=r.useState({source:"",destination:"",reducePercentage:"",reduceUrl:""}),[F,_]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const s=await m.get(`/api/v1/flights/detail-reduce-reduction-percentage/${p}`);if(s.data.success&&s.data.data){const t=s.data.data;c({source:t.reduceSrc||"",destination:t.reduceDest||"",reducePercentage:t.reduceSrcDestPercentage||"",reduceUrl:t.reduceUrl||""}),l(t.reduceSrc||""),o(t.reduceDest||"")}else g.error("Failed to fetch reduction data.")}catch(s){console.log(s),g.error("Error fetching reduction data.")}finally{_(!1)}})()},[p]);const k=()=>{!h.some(s=>s===x)&&h.length>0&&(l(h[0]),c(s=>({...s,source:h[0]}))),i(!1)},C=()=>{l(""),v([]),i(!1)},U=()=>{!u.some(s=>s===f)&&u.length>0&&(o(u[0]),c(s=>({...s,destination:u[0]}))),d(!1)},P=()=>{o(""),j([]),d(!1)},E=a=>{l(a),c(s=>({...s,source:a})),i(!1)},I=a=>{o(a),c(s=>({...s,destination:a})),d(!1)},L=async a=>{const s=a.target.value;if(l(s),c(t=>({...t,source:s})),s.length>=1)try{const t=await m.get(`/api/v1/flights/locations?keyword=${s}`);v(t.data),i(!0)}catch(t){console.error("Error fetching locations:",t)}else i(!1)},V=async a=>{const s=a.target.value;if(o(s),c(t=>({...t,destination:s})),s.length>=1)try{const t=await m.get(`/api/v1/flights/locations?keyword=${s}`);j(t.data),d(!0)}catch(t){console.error("Error fetching locations:",t)}else d(!1)},S=a=>{const{id:s,value:t}=a.target;c(q=>({...q,[s]:t}))},B=async a=>{a.preventDefault();try{const s={reduceSrc:n.source,reduceDest:n.destination,reduceSrcDestPercentage:n.reducePercentage,reduceUrl:n.reduceUrl},t=await m.patch(`/api/v1/flights/reduction-percentage-srcDest-update/${p}`,s);t.data.success?(g.success(t.data.message),D(-1)):g.error(t.data.message||"Update failed")}catch(s){console.log(s),g.error("Failed to update. Please try again.")}};return F?e.jsx(N,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(y,{}),e.jsx("div",{className:"flex-grow-1 p-4",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:"Loading..."})})})]})}):e.jsx(N,{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(y,{}),e.jsx("div",{className:"flex-grow-1 p-4",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"text-center",children:"Edit Source & Dest"}),e.jsxs("form",{onSubmit:B,className:"form_booking",children:[e.jsxs("div",{className:"form_booking",children:[e.jsxs("div",{className:"form_holdd text-start relative",children:[e.jsx("label",{htmlFor:"source",children:"Source"}),e.jsx("input",{type:"text",id:"source",onChange:L,value:x,onBlur:k,onFocus:C,className:"form-control",required:!0,placeholder:"Search airports"}),e.jsx("div",{className:"listing_airport_ul",children:w&&e.jsx("ul",{className:"autoSugge-ul",children:h.map(a=>e.jsxs("li",{className:"autoSuggestData cursor-pointer",onClick:()=>E(a),children:[e.jsx("span",{className:"listing_airport_icon",children:e.jsx("img",{src:"/imgs/airline-img.png",alt:""})}),e.jsx("span",{children:a})]},a))})})]}),e.jsxs("div",{className:"form_holdd text-start relative",children:[e.jsx("label",{htmlFor:"destination",children:"Dest"}),e.jsx("input",{type:"text",id:"destination",onChange:V,value:f,onBlur:U,onFocus:P,className:"form-control",required:!0,placeholder:"Search airports"}),e.jsx("div",{className:"listing_airport_ul",children:b&&e.jsx("ul",{className:"autoSugge-ul",children:u.map(a=>e.jsxs("li",{className:"autoSuggestData cursor-pointer",onClick:()=>I(a),children:[e.jsx("span",{className:"listing_airport_icon",children:e.jsx("img",{src:"/imgs/airline-img.png",alt:""})}),e.jsx("span",{children:a})]},a))})})]}),e.jsxs("label",{htmlFor:"reducePercentage",children:["Discount ",e.jsx("span",{children:"*"})]}),e.jsx("div",{className:"form_input",children:e.jsx("input",{type:"number",maxLength:"3",id:"reducePercentage",value:n.reducePercentage,onChange:S,required:!0,placeholder:"Enter reduction percentage",className:"form-control",min:"0",max:"100"})}),e.jsxs("div",{className:"col-md-9 mb-3",children:[e.jsx("label",{htmlFor:"reduceUrl",className:"form-label",children:"Reduce Url"}),e.jsxs("select",{id:"reduceUrl",className:"form-select",value:n.reduceUrl,onChange:S,required:!0,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"faresway.com",children:"Faresway"}),e.jsx("option",{value:"traveloways.com",children:"Traveloways"}),e.jsx("option",{value:"faresvilla.com",children:"Faresvilla"})]})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Update"})]})]})})})]})})};export{A as default};
