import{r as c,i as F,j as s,b as u}from"./index-DDoEHnfR.js";import{L as U}from"./Layout-Co7qzEc2.js";import{S as L}from"./SideBar-DCoEgSRU.js";const A=()=>{const[g,a]=c.useState([]),[h,N]=c.useState([]),[y,w]=c.useState([]),[i,p]=c.useState(""),[d,f]=c.useState(""),[n,b]=c.useState(""),k=F(),j=new URLSearchParams(k.search).get("url"),x=j?decodeURIComponent(j):null;c.useEffect(()=>{(async()=>{try{const r=await u.get("/api/v1/ctmFlights/get-provider");r.data.success&&w(r.data.booking)}catch(r){console.error("Failed to fetch providers",r)}})()},[]),c.useEffect(()=>{(async()=>{try{const r=await u.get("/api/v1/flights/get-booking-mails");if(r.data.success){const t=r.data.ctmFlightMails||[];if(N(t),x){const l=t.filter(o=>{var m;return((m=o==null?void 0:o.webUrl)==null?void 0:m.trim())===x.trim()});a(l)}else a(t)}else console.error("Failed to fetch booking mails:",r.data.message)}catch(r){console.error("Error fetching booking mails:",r)}})()},[x]);const M=async(e,r)=>{if(!e){console.error("URL is undefined");return}const t=i||d||n,l=i&&d&&n;if(t&&!l){alert("Please select From Date, To Date, and Provider before running deals.");return}try{const o={webUrl:e,webMail:r};l&&(o.fromDate=i,o.toDate=d,o.provider=n),await u.post("/api/v1/flights/webUrl",o),console.log(" URL sent successfully:",o)}catch(o){o.response?console.error("Failed to send URL:",o.response.data):console.error("Error sending URL:",o.message)}},v=Array.from(new Set(g.map(e=>JSON.stringify({url:e==null?void 0:e.webUrl,mail:e==null?void 0:e.webMail})))).map(e=>JSON.parse(e)).filter(e=>e.url||e.mail),S=()=>{let e=[...h];console.log("from is ",i),console.log("to is ",d),console.log("provider is ",n);const r=(t,l)=>t.getDate()===l.getDate()&&t.getMonth()===l.getMonth()&&t.getFullYear()===l.getFullYear();if(i){const t=new Date(i);e=e.filter(l=>{const o=new Date(l.createdAt);return r(o,t)})}if(d){const t=new Date(d);e=e.filter(l=>{const o=new Date(l.createdAt);return r(o,t)})}n&&(console.log("Selected Provider:",n),e=e.filter(t=>{var l,o;return(t==null?void 0:t.provider)&&((o=(l=t==null?void 0:t.provider)==null?void 0:l.provider)==null?void 0:o.toLowerCase().includes(n.toLowerCase()))})),a(e)};return s.jsx(U,{children:s.jsxs("div",{className:"d-flex",children:[s.jsx(L,{}),s.jsxs("div",{className:"flex-grow-1 p-4",children:[s.jsx("h2",{className:"text-start",children:"Booking Mails"}),s.jsxs("div",{className:"card p-3 mb-3 shadow-sm",children:[s.jsx("h5",{className:"text-start mb-3",children:"Filters"}),s.jsxs("div",{className:"row align-items-end",children:[s.jsxs("div",{className:"col-md-3",children:[s.jsx("label",{className:"form-label",children:"From Date"}),s.jsx("input",{type:"date",className:"form-control",value:i,onChange:e=>p(e.target.value)})]}),s.jsxs("div",{className:"col-md-3",children:[s.jsx("label",{className:"form-label",children:"To Date"}),s.jsx("input",{type:"date",className:"form-control",value:d,onChange:e=>f(e.target.value)})]}),s.jsxs("div",{className:"col-md-3",children:[s.jsx("label",{className:"form-label",children:"Select Provider"}),s.jsxs("select",{className:"form-select",value:n,onChange:e=>b(e.target.value),children:[s.jsx("option",{value:"",children:"All Providers"}),y.filter(e=>e.providerStatus==="Active").map(e=>s.jsx("option",{value:e.provider,children:e.provider},e._id))]})]}),s.jsxs("div",{className:"col-md-3 d-flex gap-2",children:[s.jsx("button",{className:"btn btn-primary w-50",onClick:S,children:"Apply Filter"}),s.jsx("button",{className:"btn btn-secondary w-50",onClick:()=>{p(""),f(""),b(""),a(h)},children:"Reset"})]})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-start",children:"Booking URLs and WebMails"}),s.jsx("div",{children:v.length>0?s.jsx("ul",{className:"list-group",children:v.map((e,r)=>s.jsxs("li",{className:"list-group-item",children:[e.url&&s.jsx("span",{className:"text-primary p-1",style:{background:"none",border:"none",textDecoration:"underline"},children:e.url}),e.mail&&s.jsx("span",{className:"text-secondary p-1",style:{marginLeft:"10px"},children:e.mail}),s.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>M(e.url,e.mail),children:"Run Deals"})]},r))}):s.jsx("p",{children:"No booking URLs or webMails available."})})]}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-3",children:[s.jsx("div",{}),s.jsx("button",{className:"btn btn-success",onClick:()=>a(h),children:"Reload All"})]}),s.jsxs("table",{className:"table table-striped table-bordered",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Sr. No"}),s.jsx("th",{children:"Mail"}),s.jsx("th",{children:"Phone"}),s.jsx("th",{children:"Type"}),s.jsx("th",{children:"Website"})]})}),s.jsx("tbody",{children:g.map((e,r)=>s.jsxs("tr",{children:[s.jsx("td",{children:r+1}),s.jsx("td",{children:e==null?void 0:e.email}),s.jsx("td",{children:e==null?void 0:e.mobile}),s.jsx("td",{children:e==null?void 0:e.type}),s.jsx("td",{children:s.jsx("span",{className:"text-success outline-0 border-0 bg-transparent",children:e!=null&&e.webUrl?e==null?void 0:e.webUrl:"No URL"})})]},r))})]})]})]})})};export{A as default};
